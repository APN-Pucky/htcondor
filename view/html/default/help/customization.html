{% extends "base.html" %}

{% block title %}
    HTCondorView - Customization
{% endblock title %}

{% block style %}
    <style>
        table.table tr td:first-child {
            font-family: monospace;
        }
    </style>
{% endblock style %}

{% block head %}
    <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
{% endblock head %}

{% block body %}

    <div class="container">
        <div class="row">
            <div class="col-9">
                <h1>Customizing HTCondor View</h1>

                <h2 id="simple-modifications">Simple Modifications</h2>

                <p>
                    There are a few simple customizations that don't require re-rendering HTCondor View's HTML.
                    <b>Because you aren't modifying the underlying HTML templates, these modifications are not permanent.</b>
                </p>

                <h2 id="logo-swap">Logo Swap</h2>

                <p>
                    To switch out the logo which appears in the top left corner of each page (on the navbar), simply replace
                    <code>view/static/navbar_logo.svg</code> with your own SVG logo.
                </p>


                <h2 id="html-generation">HTML Generation</h2>

                <p>
                    To fully customize HTCondor View, you'll need to:
                <ol>
                    <li>
                        Be able to
                        <a href="https://www.python.org/downloads/release">install Python 3.6+</a>
                        and a few dependencies, then run a script from the command line
                    </li>
                    <li>
                        Know how to write a little bit of HTML/CSS/Javascript, depending on what you want to customize
                    </li>
                </ol>

                <p>
                    Although the Javascript that renders the graphs is difficult to customize, the surrounding HTML and CSS is easy to replace with your own, custom work.
                    Any changes you make will be permanent and will not be overwritten by future updates to the defaults.
                </p>

                <h3 id="overview">Overview</h3>

                <p>
                    The HTML for HTCondor View is generated by rendering HTML templates using
                    <a href="http://jinja.pocoo.org/docs/2.10/">Jinja2</a>.
                    Which templates are rendered into actual pages is determined by the file
                    <code>html/sitemap.json</code>,
                    which specifies a hierarchical structure for the resulting website.
                    The default HTML templates and static files are stored in
                    <code>html/default/</code>, and your custom files are stored in
                    <code>html/custom/</code>, which you should create if it doesn't exist.
                </p>

                <p>
                    The descriptions of Jinja2 and Bootstrap given here are necessarily brief - both are huge subjects,
                    and their own websites and tutorials do a much better job of explaining them than we can do here.
                    Instead this page focuses on how we use Jinja2 and Bootstrap in HTCondor View.
                </p>

                <h3 id="the-sitemap">The Sitemap</h3>
                <p>
                    The sitemap, store in
                    <code>html/sitemap.json</code>, determines the structure of the HTCondor View website.
                    Each key should be the name of a link, or the name of a group of links.
                    The value for each link should be the name (not the path) of the HTML template for that page.
                    Keys with a
                    <code>#</code> prefix are "hidden": they are rendered, but not placed in the navigation bar (navbar) at the top of the site.
                    You can still link to these pages manually.
                </p>

                <pre><code class="json"># html/sitemap.json
{
  "Overview": "index.html",
  "Submitters": {
    "Job Status": "job_status.html",
    "Cluster Usage": "cluster_usage.html"
  },
  "Slots": {
    "Multicore Utilization": "multicore_utilization.html"
  },
  "Operations": {
    "CPU and Memory": "cpu_and_memory.html",
    "Memory Efficiency": "memory_efficiency.html"
  },
  "Help": {
    "Query Syntax": "syntax.html",
    "Glossary": "glossary.html",
    "Customization": "customization.html"
  },
  "#fullscreen": "fullscreen.html",
  "#edit": "edit.html"
}</code></pre>

                <h3 id="jinja2">Using Jinja2</h3>

                <p>
                    <a href="http://jinja.pocoo.org/docs/2.10/">Jinja2</a> is an HTML templating language.
                    It allows you to render a finished HTML file from HTML template files written using a combination
                    of raw HTML and special commands that insert variables or evaluate expressions.
                </p>

                <p>
                    The main thing you need to know about Jinja2 is
                    <a href="http://jinja.pocoo.org/docs/2.10/templates/#template-inheritance">template inheritance</a>.
                    A template can inherit "blocks" of HTML from another template,
                    similar to how class inheritance works in many object-oriented programming languages.
                    Blocks from the inherited template can be individually overridden or extended by the inheriting template.
                </p>


                <h3 id="bootstrap">Using Bootstrap</h3>

                <p>
                    <a href="https://getbootstrap.com/">Bootstrap</a> is a collection of pre-made CSS
                    and minimal Javascript tools that can help you quickly build websites.
                    The main features that HTCondor View uses from Bootstrap are a few CSS classes and the grid layout system.
                </p>

                <p>
                    Because of the flexibility of HTML/CSS, you don't need to use Bootstrap when writing your own HTCondor View pages
                    - but you'll probably want to, because it makes a lot of very hard things easy.
                </p>

                <h3 id="base-template-blocks">Base Template Blocks</h3>

                <p>
                    The table below describes the blocks in the base HTML template (<code>html/base.html</code>).
                    Any custom templates you write should inherit from this template and override (or inherit) these blocks.
                </p>

                <table class="table">
                    <tr>
                        <th>Block</th>
                        <th>Description</th>
                    </tr>

                    <tr>
                        <td>title</td>
                        <td>
                            This block contains the page title (i.e., the text that goes in the tab name in the browser).
                        </td>
                    </tr>

                    <tr>
                        <td>favicon</td>
                        <td>
                            This contains the <code>&lt;link&gt;</code> tag for the site's favicon.
                        </td>
                    </tr>

                    <tr>
                        <td>stylesheets</td>
                        <td>
                            This contains the
                            <code>&lt;link&gt;</code> tags for HTCondor View's default CSS, as well as Bootstrap.
                            You should probably use the
                            <a href="http://jinja.pocoo.org/docs/2.10/templates/#super-blocks"><code>{% raw %}{{&nbsp;super()&nbsp;}}{% endraw %}</code></a>
                            expression if you override this block so that you preserve the existing CSS
                            (unless you really do want to replace - if so, more power to you!).
                        </td>
                    </tr>

                    <tr>
                        <td>js</td>
                        <td>
                            This block contains the default Javascript
                            <code>&lt;script&gt;</code> tags for HTCondor View.
                            You should probably use the
                            <a href="http://jinja.pocoo.org/docs/2.10/templates/#super-blocks"><code>{% raw %}{{&nbsp;super()&nbsp;}}{% endraw %}</code></a>
                            expression if you override this block so that you preserve the existing Javascript
                            (unless you really do want to replace - if so, more power to you!).
                        </td>
                    </tr>

                    <tr>
                        <td>style</td>
                        <td>
                            This is an initially-empty block to put any additional page-specific
                            <code>&lt;script&gt;</code> in.
                            The <code>&lt;script&gt;</code> tag itself is not included.
                            Note that if you have a lot of CSS to add, you should probably make a custom CSS file in
                            <code>html/custom/static</code> and link to it from the <code>stylesheets</code> tag.
                        </td>
                    </tr>

                    <tr>
                        <td>head</td>
                        <td>
                            This is an initially-empty block to put any additional HTML into the
                            <code>&lt;head&gt;</code> tag of the HTML.
                        </td>
                    </tr>

                    <tr>
                        <td>navbar</td>
                        <td>
                            This block contains the default navigation bar, built using
                            <a href="https://getbootstrap.com/docs/4.1/components/navbar/">Bootstrap</a>.
                        </td>
                    </tr>

                    <tr>
                        <td>navbar_logo</td>
                        <td>
                            This block contains the default <code>&lt;img&gt;</code> tag that links to the navbar logo.
                            Note that this block is inside the
                            <code>navbar</code> block, so overriding both at once may produce unexpected results.
                        </td>
                    </tr>

                    <tr>
                        <td>body</td>
                        <td>
                            This initially-empty block is where you should place anything that you want to go into the
                            <code>&lt;body&gt;</code>
                            tag of the resulting HTML.
                        </td>
                    </tr>
                </table>

                <h3 id="template-variables">Template Variables</h3>

                <p>
                    The table below describes the context variables that are passed to the template from Python.
                    They are available for interpolation via <code>{% raw %}{{&nbsp;variable&nbsp;}}{% endraw %}</code>.
                </p>

                <p>
                    Note that Javascript does not obey <code>&lt;base&gt;</code>, so whenever you write an URL inside a
                    <code>&lt;script&gt;</code> tag you'll need to manually insert <code>{% raw %}{{&nbsp;base&nbsp;}}{% endraw %}</code> as the prefix
                    for it to resolve correctly.
                    This is also true for internal links to id's (like the ones that connect the sidebar links on this page to the headers).
                </p>

                <table class="table">
                    <tr>
                        <th>Variable</th>
                        <th>Description</th>
                    </tr>

                    <tr>
                        <td>base</td>
                        <td>
                            This variable is the string that goes in the <code>href</code> target of the HTML
                            <code>&lt;base&gt;</code> tag.
                            This ensures that relative links are correctly routed when HTCondor View is not served from the base URL of a website.
                        </td>
                    </tr>

                    <tr>
                        <td>linkmap</td>
                        <td>
                            The
                            <code>linkmap</code> is a nested dictionary that describes the mapping between the directory-like structure of the navbar
                            and the actual (relative) links to the pages.
                        </td>
                    </tr>

                    <tr>
                        <td>current_page</td>
                        <td>
                            This variable is the string giving the (relative) link to the current page.
                        </td>
                    </tr>
                </table>
            </div>


            <div class="col-sm-auto offset-7 bg-light position-fixed htcv-sidenav">
                <ul class="lvl1">
                    <li>
                        <a href="{{ current_page }}#simple-modifications">Simple Modifications</a>
                        <ul class="lvl2">
                            <li>
                                <a href="{{ current_page }}#logo-swap">Logo Swap</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="{{ current_page }}#html-generation">HTML Generation</a>
                        <ul class="lvl2">
                            <li>
                                <a href="{{ current_page }}#overview">Overview</a>
                            </li>
                            <li>
                                <a href="{{ current_page }}#the-sitemap">The Sitemap</a>
                            </li>
                            <li>
                                <a href="{{ current_page }}#jinja2">Using Jinja2</a>
                            </li>
                            <li>
                                <a href="{{ current_page }}#bootstrap">Using Bootstrap</a>
                            </li>
                            <li>
                                <a href="{{ current_page }}#base-template-blocks">Base Template Blocks</a>
                            </li>
                            <li>
                                <a href="{{ current_page }}#template-variables">Template Variables</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>

        </div>
    </div>

{% endblock body %}
