%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{\label{sec:to-8.0}Upgrading from the 7.8 series to the 8.0 series of HTCondor}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\index{upgrading!items to be aware of}
While upgrading from the 7.8 series of HTCondor to the 8.0 series 
will bring many
new features and improvements introduced in the 7.9 series of HTCondor,
it will
also introduce changes that administrators of sites running from an older
HTCondor version should be aware of when planning an upgrade.  
Here is a list of items that administrators should be aware of.

\begin{itemize}

\item
Before upgrading
to an HTCondor version at least that of 8.0.0 from a version that is HTCondor
7.8.x or earlier, the administrator should \Condor{rm} all \Condor{dagman}
jobs, allowing them to write out rescue DAGs and exit the queue, before
shutting down HTCondor to perform the upgrade.
This is because of
the new feature introduced in HTCondor version 7.9.0, 
in which \Condor{dagman} uses a single log file to monitor events.
If feasible, a suggested workaround to avoid \Condor{rm} on all the
\Condor{dagman} jobs is to set the configuration variable 
\Macro{DAGMAN\_ALWAYS\_USE\_NODE\_LOG} to
\Expr{False} in a DAG configuration file
 before restarting HTCondor in all 7.8 \Condor{dagman} jobs.
\Condor{dagman} jobs that have a chance to write out a rescue
DAG
are expected to successfully restart after the upgrade.
These jobs are those that are the target of \Condor{rm} or that have failed.
Administrators can be proactive by
checking that no \Condor{dagman} jobs are on hold or running in the queue when the
upgrade occurs, and encourage users to use the halt file feature and release
their \Condor{dagman} jobs before the upgrade.  
Running \Condor{rm} on a held \Condor{dagman} job is
not advised in this case, unless the user is abandoning the job.
This problem should be fixed in HTCondor version 8.0.1, so that DAGMan jobs
will run smoothly across such an upgrade.

\item The upgrade will change the machine ClassAd attribute
\AdAttr{CheckpointPlatform} for all machines.
This implies that any standard universe job with a checkpoint 
from before the upgrade will not resume after the upgrade.
To work around this potential difficulty, either change the 
attribute \AdAttr{CheckpointPlatform} on all machines to their previous value 
by setting the \Macro{CHECKPOINT\_PLATFORM} configuration variable,
or change the \AdAttr{LastCheckpointPlatform} attribute for all jobs
that have produced a checkpoint.
Make the change by using \Condor{qedit}.

For example, if machine attribute \AdAttr{CheckpointPlatform} changed 
from \verb;LINUX INTEL 2.6.x normal N/A; to 
\verb;LINUX INTEL 2.6.x normal N/A ssse3 sse4_1 sse4_2;,
use the following command:

\footnotesize
\begin{verbatim}
condor_qedit -constraint 'LastCheckpointPlatform == "LINUX INTEL 2.6.x normal N/A"'
    LastCheckpointPlatform "LINUX INTEL 2.6.x normal N/A ssse3 sse4_1 sse4_2"
\end{verbatim}
\normalsize

\end{itemize}

