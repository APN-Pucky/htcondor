#!/usr/bin/env perl
use File::Spec;

######################################################################
# $Id: platform_post_new,v 1.1 2005-07-13 22:30:43 akarp Exp $
# post script to cleanup platform-specific files on the submit side
######################################################################

# we just want to chmod everything in the local directory (the
# per-platform directory on the submit side, after everything was
# transfered back) to be world-readable so that other folks can see
# the results.  until Condor's file transfer mechanism preserves
# permissions, we'll have to use this hack. :(

my $glue = $ARGV[0];

system("chmod a+r *");

my $tag = $ENV{NMI_tag};
my $module = $ENV{NMI_module};
print "From the environment: tag = $tag\n";
print "From the environment: module = $module\n";
my $runid = `nmi_gid2runid $ENV{_NMI_GID}`;
chomp $runid;

system("nmi_glue/test_submit/condor_test_submit.pl " .
       "--buildid=$runid --platform=$ENV{NMI_PLATFORM} " . 
       " --nmi-glue=$glue --workspace");

my $status = $?;
if( $status ) {
    die "condor_test_submit.pl failed with status $status\n";
}

exit 0;
