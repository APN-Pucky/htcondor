all: libclassad.a test_classads sample

INSTALL_DIR = install
LIB_INSTALL = install/lib
BIN_INSTALL = install/bin
INCLUDE_INSTALL = install/include

CPlusPlus = g++
C_PLUS_FLAGS = -Wall -g -DCLASSAD_DISTRIBUTION
INST_C_PLUS_FLAGS = $(C_PLUS_FLAGS) -w
NO_INST_C_PLUS_FLAGS = -fno-implicit-templates $(C_PLUS_FLAGS)

.C.o:
	$(CPlusPlus) $(NO_INST_C_PLUS_FLAGS) -c $<

LIB_OBJ = attrrefs.o classad.o collection.o collectionBase.o debug.o \
exprList.o exprTree.o fnCall.o lexer.o literals.o matchClassad.o \
operators.o query.o sink.o source.o transaction.o value.o \
view.o instantiations.o 

HEADER_FILES = $(shell \ls *.[h])

libclassad.a:  $(LIB_OBJ)
	rm -f  libclassad.a
	ar vrs libclassad.a  $(LIB_OBJ)

instantiations.o:   instantiations.C
	$(CPlusPlus) $(INST_C_PLUS_FLAGS) -c instantiations.C -o instantiations.o

test_classads: test_classads.o libclassad.a
	$(CPlusPlus) -o test_classads test_classads.o -L. -lclassad

sample: sample.o libclassad.a
	$(CPlusPlus) -o sample sample.o -L. -lclassad

install: libclassad.a test_classads
	rm -rf $(INSTALL_DIR)
	mkdir $(INSTALL_DIR)
	mkdir $(LIB_INSTALL)
	mkdir $(BIN_INSTALL)
	mkdir $(INCLUDE_INSTALL)
	cp libclassad.a $(LIB_INSTALL)
	cp test_classads $(BIN_INSTALL)
	cp $(HEADER_FILES) $(INCLUDE_INSTALL)

clean: tidy
	rm -f test_classads libclassad.a
tidy:
	rm -f *.o *~ *.bak

